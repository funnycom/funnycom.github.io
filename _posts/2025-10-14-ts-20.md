---
title: "[TS] HTTPì™€ API ë‹¤ë£¨ê¸° - 5"
date: 2025-10-14 23:30:00 +0900
categories: [ì›¹ ê°œë°œ, íƒ€ì…ìŠ¤í¬ë¦½íŠ¸]
tags: [ì›¹ê°œë°œ, íƒ€ì…ìŠ¤í¬ë¦½íŠ¸, TS, http, api]
pin: true
math: true
mermaid: true
published: false
---

> **í•™ìŠµ ëª©í‘œ**
> - HTTP í”„ë¡œí† ì½œì´ ë¬´ì—‡ì¸ì§€ ì´í•´í•œë‹¤
> - REST APIì˜ ê°œë…ê³¼ ì„¤ê³„ ì›ì¹™ì„ ì•ˆë‹¤
> - TypeScriptì—ì„œ APIë¥¼ í˜¸ì¶œí•˜ê³  ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤
> - async/awaitë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸° ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤
> - íƒ€ì… ì•ˆì „í•œ API í†µì‹ ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤
> - ì—ëŸ¬ ì²˜ë¦¬ì™€ ë¡œë”© ìƒíƒœë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤

--- 

### ê³¼ì œ 3: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ API ì„œë¹„ìŠ¤ í´ë˜ìŠ¤

ì œë„¤ë¦­ê³¼ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í¬í•¨í•œ ë²”ìš© API ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.

**ìš”êµ¬ì‚¬í•­:**
- ì œë„¤ë¦­ì„ í™œìš©í•œ íƒ€ì… ì•ˆì „ì„±
- ëª¨ë“  HTTP ë©”ì„œë“œ ì§€ì›
- ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë¡œì§
- ë¡œë”© ìƒíƒœ ê´€ë¦¬
- ìš”ì²­/ì‘ë‹µ ì¸í„°ì…‰í„°

```typescript
// ì—¬ê¸°ë¥¼ ì™„ì„±í•˜ì„¸ìš”
```

#### ì •ë‹µ 3: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ API ì„œë¹„ìŠ¤ í´ë˜ìŠ¤

```typescript
// API ì‘ë‹µ ë˜í¼
interface ApiResponse<T> {
  success: boolean;
  data: T | null;
  error: string | null;
  statusCode: number;
}

// ìš”ì²­ ì˜µì…˜
interface RequestOptions extends RequestInit {
  retry?: number;        // ì¬ì‹œë„ íšŸìˆ˜
  retryDelay?: number;   // ì¬ì‹œë„ ê°„ê²© (ms)
  timeout?: number;      // íƒ€ì„ì•„ì›ƒ (ms)
}

// ì¸í„°ì…‰í„° íƒ€ì…
type RequestInterceptor = (config: RequestInit) => RequestInit | Promise<RequestInit>;
type ResponseInterceptor = (response: Response) => Response | Promise<Response>;
type ErrorInterceptor = (error: Error) => Error | Promise<Error>;

class ApiService {
  private baseUrl: string;
  private defaultHeaders: Record<string, string>;
  private requestInterceptors: RequestInterceptor[] = [];
  private responseInterceptors: ResponseInterceptor[] = [];
  private errorInterceptors: ErrorInterceptor[] = [];
  private loadingStates: Map<string, boolean> = new Map();
  
  constructor(baseUrl: string, defaultHeaders: Record<string, string> = {}) {
    this.baseUrl = baseUrl;
    this.defaultHeaders = {
      "Content-Type": "application/json",
      ...defaultHeaders
    };
  }
  
  // í—¤ë” ì„¤ì •
  setHeader(key: string, value: string): void {
    this.defaultHeaders[key] = value;
  }
  
  // í—¤ë” ì‚­ì œ
  removeHeader(key: string): void {
    delete this.defaultHeaders[key];
  }
  
  // ì¸ì¦ í† í° ì„¤ì •
  setAuthToken(token: string): void {
    this.setHeader("Authorization", \`Bearer \${token}\`);
  }
  
  // ì¸í„°ì…‰í„° ì¶”ê°€
  addRequestInterceptor(interceptor: RequestInterceptor): void {
    this.requestInterceptors.push(interceptor);
  }
  
  addResponseInterceptor(interceptor: ResponseInterceptor): void {
    this.responseInterceptors.push(interceptor);
  }
  
  addErrorInterceptor(interceptor: ErrorInterceptor): void {
    this.errorInterceptors.push(interceptor);
  }
  
  // ë¡œë”© ìƒíƒœ
  isLoading(key: string): boolean {
    return this.loadingStates.get(key) || false;
  }
  
  private setLoading(key: string, loading: boolean): void {
    this.loadingStates.set(key, loading);
  }
  
  // íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬
  private async fetchWithTimeout(
    url: string,
    options: RequestInit,
    timeout: number
  ): Promise<Response> {
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), timeout);
    
    try {
      const response = await fetch(url, {
        ...options,
        signal: controller.signal
      });
      clearTimeout(timeoutId);
      return response;
    } catch (error) {
      clearTimeout(timeoutId);
      if (error instanceof Error && error.name === "AbortError") {
        throw new Error("ìš”ì²­ ì‹œê°„ ì´ˆê³¼");
      }
      throw error;
    }
  }
  
  // ì¬ì‹œë„ ë¡œì§
  private async fetchWithRetry(
    url: string,
    options: RequestInit,
    retry: number,
    retryDelay: number,
    timeout: number
  ): Promise<Response> {
    let lastError: Error | null = null;
    
    for (let i = 0; i <= retry; i++) {
      try {
        const response = await this.fetchWithTimeout(url, options, timeout);
        return response;
      } catch (error) {
        lastError = error instanceof Error ? error : new Error("ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬");
        
        if (i < retry) {
          console.log(\`ì¬ì‹œë„ \${i + 1}/\${retry}...\`);
          await new Promise(resolve => setTimeout(resolve, retryDelay));
        }
      }
    }
    
    throw lastError;
  }
  
  // í•µì‹¬ ìš”ì²­ ë©”ì„œë“œ
  private async request<T>(
    endpoint: string,
    options: RequestOptions = {}
  ): Promise<ApiResponse<T>> {
    const {
      retry = 0,
      retryDelay = 1000,
      timeout = 10000,
      ...fetchOptions
    } = options;
    
    const url = \`\${this.baseUrl}\${endpoint}\`;
    const loadingKey = \`\${fetchOptions.method || "GET"}:\${endpoint}\`;
    
    this.setLoading(loadingKey, true);
    
    try {
      // ìš”ì²­ ì„¤ì •
      let config: RequestInit = {
        ...fetchOptions,
        headers: {
          ...this.defaultHeaders,
          ...fetchOptions.headers
        }
      };
      
      // ìš”ì²­ ì¸í„°ì…‰í„° ì‹¤í–‰
      for (const interceptor of this.requestInterceptors) {
        config = await interceptor(config);
      }
      
      // API í˜¸ì¶œ (ì¬ì‹œë„ í¬í•¨)
      let response = await this.fetchWithRetry(
        url,
        config,
        retry,
        retryDelay,
        timeout
      );
      
      // ì‘ë‹µ ì¸í„°ì…‰í„° ì‹¤í–‰
      for (const interceptor of this.responseInterceptors) {
        response = await interceptor(response);
      }
      
      // HTTP ì—ëŸ¬ ì²´í¬
      if (!response.ok) {
        throw new Error(\`HTTP error! status: \${response.status}\`);
      }
      
      // JSON íŒŒì‹±
      const data: T = await response.json();
      
      return {
        success: true,
        data,
        error: null,
        statusCode: response.status
      };
    } catch (error) {
      let processedError = error instanceof Error 
        ? error 
        : new Error("ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬");
      
      // ì—ëŸ¬ ì¸í„°ì…‰í„° ì‹¤í–‰
      for (const interceptor of this.errorInterceptors) {
        processedError = await interceptor(processedError);
      }
      
      console.error(\`API ì—ëŸ¬ [\${loadingKey}]:\`, processedError.message);
      
      return {
        success: false,
        data: null,
        error: processedError.message,
        statusCode: 0
      };
    } finally {
      this.setLoading(loadingKey, false);
    }
  }
  
  // GET ìš”ì²­
  async get<T>(endpoint: string, options: RequestOptions = {}): Promise<ApiResponse<T>> {
    return this.request<T>(endpoint, { ...options, method: "GET" });
  }
  
  // POST ìš”ì²­
  async post<T>(
    endpoint: string,
    data?: any,
    options: RequestOptions = {}
  ): Promise<ApiResponse<T>> {
    return this.request<T>(endpoint, {
      ...options,
      method: "POST",
      body: data ? JSON.stringify(data) : undefined
    });
  }
  
  // PUT ìš”ì²­
  async put<T>(
    endpoint: string,
    data?: any,
    options: RequestOptions = {}
  ): Promise<ApiResponse<T>> {
    return this.request<T>(endpoint, {
      ...options,
      method: "PUT",
      body: data ? JSON.stringify(data) : undefined
    });
  }
  
  // PATCH ìš”ì²­
  async patch<T>(
    endpoint: string,
    data?: any,
    options: RequestOptions = {}
  ): Promise<ApiResponse<T>> {
    return this.request<T>(endpoint, {
      ...options,
      method: "PATCH",
      body: data ? JSON.stringify(data) : undefined
    });
  }
  
  // DELETE ìš”ì²­
  async delete<T>(
    endpoint: string,
    options: RequestOptions = {}
  ): Promise<ApiResponse<T>> {
    return this.request<T>(endpoint, { ...options, method: "DELETE" });
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
interface User {
  id: number;
  name: string;
  email: string;
}

interface Post {
  id: number;
  title: string;
  body: string;
  userId: number;
}

async function testApiService() {
  // API ì„œë¹„ìŠ¤ ìƒì„±
  const api = new ApiService("https://jsonplaceholder.typicode.com");
  
  // ìš”ì²­ ì¸í„°ì…‰í„° - ëª¨ë“  ìš”ì²­ ì „ì— ë¡œê·¸
  api.addRequestInterceptor((config) => {
    console.log("ğŸ“¤ ìš”ì²­:", config.method, "ì‹œê°„:", new Date().toISOString());
    return config;
  });
  
  // ì‘ë‹µ ì¸í„°ì…‰í„° - ëª¨ë“  ì‘ë‹µ í›„ì— ë¡œê·¸
  api.addResponseInterceptor((response) => {
    console.log("ğŸ“¥ ì‘ë‹µ:", response.status, response.statusText);
    return response;
  });
  
  // ì—ëŸ¬ ì¸í„°ì…‰í„° - ì—ëŸ¬ ë°œìƒ ì‹œ ë¡œê·¸
  api.addErrorInterceptor((error) => {
    console.error("âŒ ì—ëŸ¬ ì¸í„°ì…‰í„°:", error.message);
    return error;
  });
  
  console.log("=== API Service ì¢…í•© í…ŒìŠ¤íŠ¸ ===\n");
  
  // 1. GET ìš”ì²­
  console.log("1. GET ìš”ì²­ - ì‚¬ìš©ì ëª©ë¡");
  const usersResponse = await api.get<User[]>("/users");
  
  if (usersResponse.success && usersResponse.data) {
    console.log(\`âœ… \${usersResponse.data.length}ëª…ì˜ ì‚¬ìš©ì ì¡°íšŒ ì™„ë£Œ\`);
    usersResponse.data.slice(0, 3).forEach(user => {
      console.log(\`  - \${user.name} (\${user.email})\`);
    });
  }
  
  // 2. GET ìš”ì²­ (ë‹¨ì¼ ë¦¬ì†ŒìŠ¤)
  console.log("\n2. GET ìš”ì²­ - íŠ¹ì • ì‚¬ìš©ì");
  const userResponse = await api.get<User>("/users/1");
  
  if (userResponse.success && userResponse.data) {
    console.log(\`âœ… ì‚¬ìš©ì: \${userResponse.data.name}\`);
  }
  
  // 3. POST ìš”ì²­
  console.log("\n3. POST ìš”ì²­ - ê²Œì‹œê¸€ ìƒì„±");
  const newPost = {
    title: "TypeScript API Service",
    body: "ì¬ì‚¬ìš© ê°€ëŠ¥í•œ API ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤!",
    userId: 1
  };
  
  const createResponse = await api.post<Post>("/posts", newPost);
  
  if (createResponse.success && createResponse.data) {
    console.log(\`âœ… ê²Œì‹œê¸€ ìƒì„± ì™„ë£Œ (ID: \${createResponse.data.id})\`);
    console.log(\`  ì œëª©: \${createResponse.data.title}\`);
  }
  
  // 4. PATCH ìš”ì²­
  console.log("\n4. PATCH ìš”ì²­ - ê²Œì‹œê¸€ ìˆ˜ì •");
  const updateResponse = await api.patch<Post>("/posts/1", {
    title: "ìˆ˜ì •ëœ ì œëª©"
  });
  
  if (updateResponse.success && updateResponse.data) {
    console.log(\`âœ… ê²Œì‹œê¸€ ìˆ˜ì • ì™„ë£Œ\`);
    console.log(\`  ìƒˆ ì œëª©: \${updateResponse.data.title}\`);
  }
  
  // 5. DELETE ìš”ì²­
  console.log("\n5. DELETE ìš”ì²­ - ê²Œì‹œê¸€ ì‚­ì œ");
  const deleteResponse = await api.delete("/posts/1");
  
  if (deleteResponse.success) {
    console.log("âœ… ê²Œì‹œê¸€ ì‚­ì œ ì™„ë£Œ");
  }
  
  // 6. ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ (ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤)
  console.log("\n6. ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸");
  const errorResponse = await api.get<User>("/users/999999");
  
  if (!errorResponse.success) {
    console.log(\`âŒ ì˜ˆìƒëœ ì—ëŸ¬: \${errorResponse.error}\`);
  }
  
  // 7. ì¬ì‹œë„ í…ŒìŠ¤íŠ¸ (ì˜ëª»ëœ URL)
  console.log("\n7. ì¬ì‹œë„ í…ŒìŠ¤íŠ¸");
  const retryApi = new ApiService("https://invalid-url-12345.com");
  const retryResponse = await retryApi.get<any>("/test", {
    retry: 2,
    retryDelay: 500,
    timeout: 2000
  });
  
  if (!retryResponse.success) {
    console.log(\`âŒ ì¬ì‹œë„ í›„ ì‹¤íŒ¨: \${retryResponse.error}\`);
  }
  
  // 8. ë¡œë”© ìƒíƒœ í…ŒìŠ¤íŠ¸
  console.log("\n8. ë¡œë”© ìƒíƒœ í…ŒìŠ¤íŠ¸");
  const loadingTest = api.get<User[]>("/users");
  console.log("ë¡œë”© ì¤‘:", api.isLoading("GET:/users")); // true
  await loadingTest;
  console.log("ë¡œë”© ì™„ë£Œ:", api.isLoading("GET:/users")); // false
}

// ì‹¤í–‰
testApiService();
```

---
